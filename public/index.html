<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>Meltian fire it!</title>
    <link rel="stylesheet" href="reset.css"/>
    <link rel="stylesheet" href="styles.css"/>
    <link rel="stylesheet" href="index.css"/>
    <script src="https://unpkg.com/alpinejs" defer></script>
  </head>
  <body>
    <div class="background">
      <img class="logo" src="image/meltian_fire_it_logo.png">
      <div class="panel" x-data="loginFormCtrl">
        <input id="id" type="text" x-model="id" placeholder="ID">
        <input id="password" type="password" x-model="password" placeholder="password">
        <a class="button"
            x-bind:class="submitDisableFlag() ? 'disabled' : ''"
            x-on:click="submit">
          ゲームを始める
        </a>
      </div>
    </div>
  </body>
  <script>
    function loginFormCtrl () {
      return {
        id: '',
        password: '',
        // id か パスワード が未入力の間はtrueになるフラグ
        submitDisableFlag() {
          return this.id === '' || this.password === '';
        },
        async submit() {
          if (this.submitDisableFlag())
            return
          const result = await fetch(`/login?loginId=${this.id}&password=${this.password}`)
          if(result.status==200){
            alert("ok")
            const res = await result.text()
            window.location.href=`/home.html?id=${res}`
            return
          }
          if(confirm("アカウントが存在しない可能性があります。\n新しく作りますか？")){
            const res_post = await fetch("/login",{
              method:"POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ "loginId":this.id,"password":this.password})
            })
            if(res_post.status==201){
              alert("新規登録しました。")
              const res = await res_post.text()
              window.location.href=`/home.html?id=${res}`
              return
            }
            alert(await res_post.text())
          }
          return
        }
      }
    }
  </script>
</html>